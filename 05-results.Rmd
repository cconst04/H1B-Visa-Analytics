# Results
```{r, echo=FALSE}
library(dplyr)
library(mi)
library(ggplot2)
library(naniar)
library(extracat)
library(lubridate)
JOB_CODES <- c('11'='Management', '13'='Financial Operations', '23'='Legal',
               '15'='Computer and Maths', '16'='Architecture and Engineering',
               '17'='Life', '18'='Physical', '19'='Life, Physical, and Social Science',
               '21'='Community and Social Service', '25'='Educational Instruction and Library', 
               '27'='Arts, Design, Entertainment, Sports, and Media', '29'='Healthcare',
               '31'='Healthcare Support', '33'='Protective Service', '35'='Food Preparation and Serving',
               '37'='Building, Cleaning and Maintenance', '39'='Personal Care', '41'='Sales', 
               '43'='Office and Administrative Support', '45'='Farming, Fishing and Forestry',
               '47'='Construction and Extraction Occupations', '49'='Installation, Maintenance and Repair',
               '51'='Production Occupations', '53'='Transportation and Material Moving', '55'='Military'
              )
START_YEAR <- 2009
END_YEAR <- 2020
```
```{r Loading datasets}
test <- read.csv('data/raw_lca/2010.csv')
test <- test[test$LCA_CASE_EMPLOYER_STATE %in% state.abb, ]
df_ucsis <- data.frame()
for(year in START_YEAR:2020){
  tmp <- read.csv(paste0("data/raw_ucsis/", year, ".csv"))
  df_ucsis <- rbind(df_ucsis, tmp)
}
df_ucsis[df_ucsis==""] <- NA
count_applications <- list()
#read all years
df <- data.frame()
for(year in START_YEAR:END_YEAR){
  tmp <- read.csv(paste0("data/clean_lca/", year, ".csv"))
  tmp$year <- year
  df <- rbind(df, tmp)
  count_applications[[year - START_YEAR + 1]] <- nrow(data.frame(tmp))
}
df$FULL_TIME_POSITION.1 <- NULL
df$SOC_CODE <- as.character(df$SOC_CODE)
#remove 0 wage
df <- df[df$annual_wage > 0  && !is.nan(df$annual_wage),]
df_2020 <- data.frame()
for(q in 1:4){
  tmp <- read.csv(paste0("data/raw_lca/2020_q", q, ".csv"))
  df_2020 <- rbind(df_2020, tmp)
}
df_2020$BEGIN_MONTH <- month(as.Date(df_2020$BEGIN_DATE, format='%m/%d/%y'))
df_2020$BEGIN_MONTH <- sapply(df_2020$BEGIN_MONTH, function(month) month.abb[month])
df_2020$BEGIN_MONTH <- factor(df_2020$BEGIN_MONTH, levels=month.abb, ordered=TRUE)
df_sample <- sample_n(df_2020, size=30)
num_applications <- data.frame(year=START_YEAR:END_YEAR)
num_applications['total_applications'] <- unlist(count_applications)
df_tmp <- df
df_tmp <- df_tmp[!is.na(df_tmp$SOC_CODE), ]
df_tmp <- df_tmp[df_tmp$SOC_CODE %in% names(JOB_CODES),]
counts <- count(df_tmp, year, SOC_CODE)
counts <- transform(counts, SOC_CODE = JOB_CODES[SOC_CODE])
counts <- counts[!is.na(counts$SOC_CODE),]
```
  
## Number of applications per year  
```{r Applications per year, width=10, height=10}
ggplot(data=num_applications, aes(x=year, y=total_applications)) +
  geom_line() + labs(y= "Number of applications", x = "Year")
```   
  
There is an big increase in the number of applications from 2009 to 2016. After that there is some fluctuation to finally reach the 590000 applicants in 2020. This indicates that US gets more and more popular option for skilled workers that want to migrate, probably because of the attractive salaries that increase year by year, which is further analyzed in the next figure  
  
## Annual salary boxplot    
```{r, width=10, height=10}
boxplot(annual_wage ~ year, data=df, outline=FALSE, ylab='Yearly Salary')
```  
  
There is an upward trend in the 25th quartile, median, 75th quartile and maximum salary from 2009 to 2020.  We can't say anything about the minimum values because of outliers, even though salaries equal to 0 were removed. We can't remove a bigger value, because each state has different rate of pay and a minimum salary to filter isn't a clear cut   
  
## Applications by subject  
```{r, fig.width=12, fig.height=12}
ggplot(counts, aes(x=n, y=SOC_CODE)) + geom_col() + facet_wrap(~ year, ncol=2) + labs(y= "Job sector", x = "Number of applications")
```  
Jobs related to computer science and mathematics are the most famous in the H-1B applications every year. There is an increasing trend in the applications of this field from 2009 to 2015 After that the number of applications remains constant at 400000 applications per year. This also applies for the rest of the sectors and confirmed by the number of applications vs year graph  
  
```{r, echo=FALSE, width=10, height=10}
counts <- counts[counts$SOC_CODE != 'Computer and Maths',]
```  
  
## Applications by subject with Computer Science and Maths removed  
```{r, fig.width=12, fig.height=20}
ggplot(counts, aes(x=n, y=SOC_CODE)) + geom_col() + facet_wrap(~ year, ncol=2) +
  labs(y= "Job sector", x = "Number of applications")
```  
  
Financial operations is the second most famous job in the H-1B applications every year. There is an initial increase in the number of applications between 2009 and 2012. In 2013 the number of applicants is similar to that of the previous year, followed by an increase in 2014. From 2015 to 2019 there are around 480000 applicants. In 2020 the applicants are decreased to 400000. It is worth mentioning that number of applications for each sector between 2011 and 2020 are very similar. This may be because have fixed number of positions for international workers that they are applying for H-1B visa.  For the rest of sectors there is an increase between 2009 and 2011. In 2011 there is a big decrease in the management and community with social services related job applications. For the next 3 years there is a slight fluctuation in each sector. Finally, from 2015 to 2020 the number of applications for the rest of the sector is constant

